# Note on binding:
#   bind is the same as bind-key
#   -r means 'repeatable without repeating the prefix'
#   -n means 'does not need prefix'
#
# setw (and set -w) is short for set-window-option, and is window-specific
# set -g  means 'set globally',
# set -u  un-sets,
# set -a  appends to a current value (for strings)
#
# --
# select-layout even-horizontal
# Usually assigned to: C-b Meta-1
#
# select-layout even-vertical
# Usually assigned to: C-b M-2

# Start window and pane numbering at 1, not 0
set -g base-index 1
set -g pane-base-index 1

# center window list in the middle of the terminal
set -g status-justify centre

# global tmux command remap from C-b
set -g prefix C-j
# keep original prefix in case someone else wants to drive
#set -g prefix C-b
# hit ctrl-j twice to send ctrl-j to the application
bind C-j send-prefix

bind | split-window -h
bind - split-window -v

set -g history-limit 10000

bind v source-file ~/dotfiles/rcs/tmux-3-vertical-splits.rc

setw -g mode-mouse on
# switch panes with mouse (useful when other ppl drive)
set-option -g mouse-select-pane on

#set -g terminal-overrides 'xterm*:smcup@:rmcup@'
#set-window-option mode-mouse

# use h,j,k and l to move around copy buffer
setw -g mode-keys vi

# For vim-powerline
set -g default-terminal "screen-256color"

# command-line options
set-option -g status-bg blue

# Renumber windows after one is closed out
set-option -g renumber-windows on

bind t send-keys -t 4 "runtests\n"
bind b send-keys -t 4 "!!\n"

set -g pane-border-fg green
set-window-option -g window-status-current-attr bright

# selecting active window left, down, up, down
bind h select-pane -L
bind l select-pane -R
bind j select-pane -D
bind k select-pane -U

# Use Alt-vim keys without prefix key to switch panes
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R
#
## Use Alt-arrow keys without prefix key to switch panes
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

bind K kill-window

# Cycle through windows with prefix C-h/C-l
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# resizing windows, 5 at a time
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

bind r source-file ~/.tmux.conf \; display "Reloaded!"

bind a command-prompt "rename-window '%%'"

# vim
# vi-ify copy/paste mode
setw -g mode-keys vi
bind [ copy-mode
bind Escape copy-mode
bind -t vi-copy v begin-selection
bind -t vi-copy y copy-selection
bind -t vi-copy V rectangle-toggle
bind ] paste-buffer
unbind p
bind p paste-buffer

# buffer
bind Space choose-buffer

# switch tmux sessions
bind -r ( switch-client -p
bind -r ) switch-client -n

source '/home/shaw/.local/lib/python2.7/site-packages/powerline/bindings/tmux/powerline.conf'
# quiet all the business from the right-hand tmux statusline
set -g status-right-length 0

# Fix control + l
unbind-key C-l
unbind ^L
bind-key -n C-L send-keys -R
bind-key -n C-l send-keys -R

# Pressing Ctrl+Shift+Left will move the current window to the left,
# similarly right. No need to use the modifier (C-b).
bind-key -n C-S-Left swap-window -t -1
bind-key -n C-S-Right swap-window -t +1

# tmux becomes unresponsive when a lot of output is displayed, try to fix
# this by making sure tmux responds to user input. (This doesn't seem to do
# the trick)
#
# When 75 control sequences per milliseconds are being printed to the screen,
# tmux should change it's update interval to once per 1000 milliseconds
setw -g c0-change-trigger 20 # default is 250
setw -g c0-change-interval 1000 # default is 100

##bind M-y run-shell "tmux show-buffer | xclip -sel clip -i" \; display "Copied tmux buffer to system clipboard"
##bind M-y run-shell "tmux show-buffer | xclip -i" \; display "Copied tmux buffer to system clipboard"
##bind M-y run-shell "tmux show-buffer | pbcopy" \; display "Copied tmux buffer to system clipboard"

## enter copy mode immediately
set-option -sg escape-time 0

# Pane numbers disappear too quickly (in milliseconds)
set -g display-panes-time 2000

set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-urlview'

# Initialize TMUX plugin manager
# (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
